<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BudgetApp">
    <meta name="theme-color" content="#FFFFFF" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
    <meta name="apple-touch-fullscreen" content="yes">
    <title>Budget App</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>

<body>

    <!-- ================================= -->
    <!-- HEADER SECTION -->
    <!-- ================================= -->
    <div class="header">
            <div class="header-content">
                <h1>Budget</h1>
            </div>
    </div>

    <!-- ================================= -->
    <!-- MAIN CONTENT CONTAINER -->
    <!-- ================================= -->
    <div class="container">
        <div class="content">

            <!-- ============ OVERVIEW VIEW ============ -->
            <div id="overview-view" class="view active">

                <!-- Summary Cards Component -->
                <div class="summary-cards">
                    <div class="summary-card">
                        <h4>Inkomst</h4>
                        <div class="amount" id="totalIncome">0 kr</div>
                    </div>
                    <div class="summary-card">
                        <h4>Fasta utgifter</h4>
                        <div class="amount" id="expenses">0 kr</div>
                    </div>
                    <div class="summary-card">
                        <h4>Kvar</h4>
                        <div class="amount" id="remaining">0 kr</div>
                    </div>
                </div>

                <!-- Variable Expenses Mini Overview -->
                <div class="variable-expenses-mini" id="variableExpensesMini" style="display: none;">
                    <div class="variable-mini-header">
                        <h3>Månadens budget</h3>
                        <span class="view-all-link" onclick="showView('budget-view', document.querySelectorAll('.tab-btn')[1])">Se alla →</span>
                    </div>
                    <div id="variableExpensesMiniContent"></div>
                </div>

                <!-- Chart Component -->
                <div class="chart-component">
                    <canvas id="expenseChart"></canvas>
                </div>

                <!-- Debt Summary Component (Collapsible) -->
                <div class="debt-summary-component" id="debtSummaryComponent" style="display: none;">
                    <div class="debt-header-toggle" onclick="toggleDebtSection()">
                    <h3>Skulder</h3>
                        <div class="debt-header-right">
                            <svg class="chevron-debt" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div class="debt-content" id="debtContent" style="display: none;">
                    <div id="debtList"></div>
                    <div class="debt-total-container" id="debtTotalContainer"></div>
                </div> 
            </div>
            </div>

            <!-- ============ MONTHLY CHECKLIST VIEW ============ -->
            <div id="monthly-view" class="view">

                <!-- Monthly Expenses Component -->
                <div class="monthly-expenses-component" id="monthlyExpenses"></div>

                <!-- Month Controls Component -->
                <div class="month-controls">
                    <button class="reset-btn" onclick="resetCurrentMonth()">Återställ alla</button>
                </div>
            </div>

            <!-- ============ BUDGET VIEW ============ -->
            <div id="budget-view" class="view">

                <!-- Variable Expenses Budget Tracking -->
                <div class="budget-summary-card">
                    <div class="budget-summary-header">
                        <h3>Månadens budget</h3>
                        <div class="month-display" id="currentMonth"></div>
                    </div>
                    <div class="budget-summary-stats">
                        <div class="budget-stat">
                            <span class="budget-stat-label">Budget</span>
                            <span class="budget-stat-value" id="totalBudget">0 kr</span>
                        </div>
                        <div class="budget-stat">
                            <span class="budget-stat-label">Använt</span>
                            <span class="budget-stat-value spent" id="totalSpent">0 kr</span>
                        </div>
                        <div class="budget-stat">
                            <span class="budget-stat-label">Kvar</span>
                            <span class="budget-stat-value remaining" id="totalRemaining">0 kr</span>
                        </div>
                    </div>
                    <div class="budget-progress-bar">
                        <div class="budget-progress-fill" id="totalProgress"></div>
                    </div>
                </div>

                <!-- Variable Expense Categories -->
                <div id="variableExpensesContainer"></div>
            </div>
        </div>
    </div>

    <!-- ================================= -->
    <!-- NAVIGATION TAB BAR -->
    <!-- ================================= -->
    <div class="tab-bar">
        <div class="tab-bar-container">

                
            

                <div class="tab-group liquidGlass-wrapper">
                    <!-- Liquid Glass layers -->
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>

                    <button type="button" class="tab-btn active" onclick="showView('overview-view', this)">Översikt</button>
                    <button type="button" class="tab-btn" onclick="showView('budget-view', this)">Rörligt</button>
                    <button type="button" class="tab-btn" onclick="showView('monthly-view', this)">Checklista</button>
                </div>
                <button type="button" class="nav-action-btn liquidGlass-wrapper" onclick="showView('settings-view', this)">
                    <!-- Liquid Glass layers -->
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>

                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ================================= -->
    <!-- SETTINGS VIEW (converted from modal) -->
    <!-- ================================= -->
    <div id="settings-view" class="view">
        <div class="settings-header">
            <button class="back-btn" onclick="goBackFromSettings()" title="Tillbaka">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <h2>Inställningar</h2>
        </div>
        <div class="settings-root">

            <!-- Variable Expenses Settings Section -->
            <div class="settings-section">
                <h3>Varierande utgifter</h3>
                <div class="settings-content">
                    <div class="input-group">
                        <input type="text" id="newVariableExpenseName" placeholder="Namn">
                        <input type="number" id="newVariableExpenseBudget" placeholder="Belopp">
                        <button onclick="addVariableExpense()">Lägg till</button>
                    </div>
                    <div id="variableExpensesList"></div>
                </div>
            </div>

            <!-- Expense Settings Section -->
            <div class="settings-section">
                <h3>Fasta utgifter</h3>
                <div class="settings-content">
                    <div class="input-group">
                        <input type="text" id="newExpenseName" placeholder="Namn">
                        <input type="number" id="newExpenseAmount" placeholder="Belopp">
                    </div>
                    <div class="input-group">
                        <select id="newExpenseCategory"></select>
                        <button onclick="addExpense()">Lägg till</button>
                    </div>
                    <div id="expensesList"></div>
                </div>
            </div>

            <!-- Category Settings Section -->
            <div class="settings-section">
                <h3>Kategorier</h3>
                <div class="settings-content">
                    <div class="input-group">
                        <input type="text" id="newCategoryName" placeholder="Ny kategori">
                        <button onclick="addCategory()">Lägg till</button>
                    </div>
                    <div id="categoryList"></div>
                </div>
            </div>

            <!-- Income Settings Section -->
            <div class="settings-section">
                <h3>Inkomster</h3>
                <div class="settings-content">
                    <div class="input-group">
                        <input type="text" id="newIncomeName" placeholder="Namn">
                        <input type="number" id="newIncomeAmount" placeholder="Belopp">
                        <button onclick="addIncome()">Lägg till</button>
                    </div>
                    <div id="incomeList"></div>
                </div>
            </div>

            <!-- Debts (Skulder) Settings Section -->
            <div class="settings-section">
                <h3>Skulder</h3>
                <div class="settings-content">
                    <div class="input-group">
                        <input type="text" id="newDebtName" placeholder="Namn">
                        <input type="number" id="newDebtAmount" placeholder="Belopp">
                        <button onclick="addDebt()">Lägg till</button>
                    </div>
                    <div id="debtsList"></div>
                </div>
            </div>

            <!-- Data Import/Export Section -->
            <div class="settings-section">
                <h3>Data</h3>
                <div class="settings-content">
                    <div id="empty" style="margin-top:20px; font-size:14px;"></div>
                    <div class="export-import">
                        <button onclick="exportData()">Exportera Data</button>
                        <button onclick="document.getElementById('importFile').click()">Importera Data</button>
                        <input type="file" id="importFile" class="file-input" accept=".json" onchange="importData(event)">
                    </div>

                    <div id="importExportStatus" style="margin-top:10px; font-size:14px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- ================================= -->
    <!-- PAYMENT MODAL (Add/Edit Debt Payment) -->
    <!-- Inserted near the end so it's available globally -->
    <div id="debtPaymentModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="debtPaymentModalTitle">Betala skuld</h2>
                <button class="close" onclick="closeDebtPaymentModal()">&times;</button>
            </div>
                    <div class="modal-body">
                <div class="settings-content">
                    <input type="hidden" id="_debtModalIndex">
                    <input type="hidden" id="_debtModalPaymentIndex">
                    <div class="input-group">
                        <input type="number" id="paymentAmount" placeholder="Belopp (kr)" min="0" step="0.01">
                        <input type="text" id="paymentNote" placeholder="Anteckning (valfritt)">
                    </div>
                    <div id="paymentValidation" style="color:var(--system-red); font-size:13px; margin-top:6px; display:none;"></div>
                    <div style="display:flex; gap:8px; margin-top:8px;">
                        <button onclick="saveDebtPayment()">Spara</button>
                        <button onclick="closeDebtPaymentModal()">Avbryt</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


    <!-- ================================= -->
    <!-- LIQUID GLASS SVG                  -->
    <!-- ================================= -->

    <!-- CHATGPT -->
<svg style="display:none">
  <filter id="glass-distortion" x="0" y="0" width="100%" height="100%">
    <feTurbulence type="fractalNoise" baseFrequency="0.01 0.01" numOctaves="1" seed="5" result="turbulence"/>
    <feComponentTransfer in="turbulence" result="mapped">
      <feFuncR type="gamma" amplitude="1" exponent="10" offset="0.5"/>
      <feFuncG type="gamma" amplitude="0" exponent="1" offset="0"/>
      <feFuncB type="gamma" amplitude="0" exponent="1" offset="0.5"/>
    </feComponentTransfer>
    <feGaussianBlur in="turbulence" stdDeviation="3" result="softMap"/>
    <feSpecularLighting in="softMap" surfaceScale="5" specularConstant="1" specularExponent="100" result="specLight">
      <fePointLight x="-200" y="-200" z="300"/>
    </feSpecularLighting>
    <feComposite in="specLight" operator="arithmetic" k2="1" k3="1"/>
    <feDisplacementMap in="SourceGraphic" in2="softMap" scale="50" xChannelSelector="R" yChannelSelector="G"/>
  </filter>
</svg>

</html>